!function(G,w,X){"use strict";function o(Z,B){this.position=Z,this.$22n=B}var r="ht",z=G[r],q=null,h=Math,B=h.PI,K=h.cos,P=h.sin,T=h.abs,i=h.max,y=h.sqrt,u=1e-5,D=z.Default,j=D.def,C=D.startAnim,$=D.createMatrix,H=D.transformVec,I=D.getInternal(),N=I.addMethod,J=I.superCall,p=I.toPointsArray,R=I.createNormals,b=I.toFloatArray,Q=I.glMV,W=(I.glPop,z.graph3d.Graph3dView,z.Math),c=W.Vector3,S=W.Matrix4,Y=W.Euler,m=(W.Quaternion,I.batchShape),V=I.createNodeMatrix,d=I.getFaceInfo,t=I.transformAppend,l=I.drawFaceInfo,Z=I.createAnim,_=I.cube(),F=_.is,A=_.vs,n=_.uv,g=I.ui(),k=z.Node,x=z.Shape,e="h",M="v",O="front",L="back",s="left",E="right",v="top",f="bottom",a="dw.expanded",U=".expanded",xb="dw.angle",Nh=".angle",Re=function(G,m,k){j(r+"."+G,m,k)},jl=function(K,M,F){F?K.push(M.x,M.y):K.push(M.x,M.y,M.z)},cr=function(){var A=new z.Math.Vector3,W=new z.Math.Vector3,N=new z.Math.Vector3;return function(V,g,b,G,Z){if(A.copy(g.$24n),W.copy(b.$24n),N.copy(G.$24n),!(N.equals(A)||W.equals(A)||W.equals(N))){if(!g.$22n||!b.$22n||!G.$22n){var U=W.sub(A).cross(N.sub(A)).normalize().multiplyScalar(1).toArray();g.$22n||(g.$22n=new sn(U)),b.$22n||(b.$22n=new sn(U)),G.$22n||(G.$22n=new sn(U))}V.push(new jc([g,b,G],Z))}}}(),xs=function(f,o,g,W){var h,p,i,_,k=0,N=[];if(W)for(h=W.length;h>k;k+=3)p=W[k],i=W[k+1],_=W[k+2],cr(N,new Vn([o[3*p],o[3*p+1],o[3*p+2]],null,g?[g[2*p],g[2*p+1],0]:q),new Vn([o[3*i],o[3*i+1],o[3*i+2]],null,g?[g[2*i],g[2*i+1],0]:q),new Vn([o[3*_],o[3*_+1],o[3*_+2]],null,g?[g[2*_],g[2*_+1],0]:q),f);else for(h=o.length/3;h>k;k+=3)p=k,i=k+1,_=k+2,cr(N,new Vn([o[3*p],o[3*p+1],o[3*p+2]],null,g?[g[2*p],g[2*p+1],0]:q),new Vn([o[3*i],o[3*i+1],o[3*i+2]],null,g?[g[2*i],g[2*i+1],0]:q),new Vn([o[3*_],o[3*_+1],o[3*_+2]],null,g?[g[2*_],g[2*_+1],0]:q),f);return N},Bi=[s,O,E,L,v,f],Qm=["",v,f],Ei=Bi.concat("csg"),Xf=[0,6,12,18,24,30],Eo=function(b,L,N){var R=V(b),S=[];b.appendAnchorMatrix3d(R);var k,$=L?L.getData3dUI(b):null;if($&&$.s("shape3d")&&!$.s("csg.cull.box")&&(k=$.shapeModel,$.shapeModel||(k=I.getShapeModel($,$.s("shape3d"))),k))for(var Z=I.createNormalMatrix(R),e=0,W=Qm.length;W>e;e++){var s=Qm[e],E=s.length?s+"_":s,m=k[E+"vs"],G=k[E+"uv"],y=k[E+"is"],g=k[E+"ns"];if(m&&m.length)for(var J,X,B,U=0,p=y?y.length:m.length/3;p>U;U+=3)y?(J=y[U],X=y[U+1],B=y[U+2]):(J=U,X=U+1,B=U+2),cr(S,new Vn(H([m[3*J],m[3*J+1],m[3*J+2]],R),g?H([g[3*J],g[3*J+1],g[3*J+2]],Z):null,[G[2*J],G[2*J+1],0]),new Vn(H([m[3*X],m[3*X+1],m[3*X+2]],R),g?H([g[3*X],g[3*X+1],g[3*X+2]],Z):null,[G[2*X],G[2*X+1],0]),new Vn(H([m[3*B],m[3*B+1],m[3*B+2]],R),g?H([g[3*B],g[3*B+1],g[3*B+2]],Z):null,[G[2*B],G[2*B+1],0]),b)}if(!k)for(var e=0;6>e;e++)for(var s=Bi[e],x=Xf[e],G=N?L.getFaceUv(b,s):q,w=N?L.getFaceUvScale(b,s):q,z=N?L.getFaceUvOffset(b,s):q,Y=0;2>Y;Y++){var C,K,c,r=F[x+3*Y],f=F[x+3*Y+1],o=F[x+3*Y+2];if(N){if(G){var v=8*e;C=[G[2*r-v],G[2*r+1-v],0],K=[G[2*f-v],G[2*f+1-v],0],c=[G[2*o-v],G[2*o+1-v],0]}else C=[n[2*r],n[2*r+1],0],K=[n[2*f],n[2*f+1],0],c=[n[2*o],n[2*o+1],0];w&&(C[0]*=w[0],C[1]*=w[1],K[0]*=w[0],K[1]*=w[1],c[0]*=w[0],c[1]*=w[1]),z&&(C[0]+=z[0],C[1]+=z[1],K[0]+=z[0],K[1]+=z[1],c[0]+=z[0],c[1]+=z[1])}cr(S,new Vn(H([A[3*r],A[3*r+1],A[3*r+2]],R),null,C),new Vn(H([A[3*f],A[3*f+1],A[3*f+2]],R),null,K),new Vn(H([A[3*o],A[3*o+1],A[3*o+2]],R),null,c),b)}return kf.$15n(S)},id=function(d,C){var P,L=d.data.getAttaches();if(L&&L.each(function(w){w instanceof Nn&&w.s("attach.operation")&&(P||(P=[]),P.push(w))}),P){var x;Bi.forEach(function(a){var N=xs(a,d[a].vs,d[a].tuv);x=x?x.concat(N):N}),x=kf.$15n(x),P.forEach(function(G){var b=G.s("attach.operation");x[b]&&(x=x[b](Eo(G,d.gv,d.csg.tuv)))}),Bi.forEach(function(F){F=d[F],F.vs=[],F.ns=[],F.tuv&&(F.tuv=[])}),d.csg&&!d.csg.ns&&(d.csg.ns=[]);var N=[];if(x.$19n().forEach(function(p){var W,o=p.$10n;if(o instanceof Nn){if(o.s("attach.cull"))return;W=o.s("csg.cull.color"),W&&(W=I.toColorArray(W)),o="csg"}for(var b=d[o],_=b.vs,i=b.ns,t=b.tuv,D=p.$9n,R=2;R<D.length;R++)if(jl(_,D[0].$24n),jl(_,D[R-1].$24n),jl(_,D[R].$24n),i&&(jl(i,D[0].$22n),jl(i,D[R-1].$22n),jl(i,D[R].$22n)),t&&(jl(t,D[0].uv,!0),jl(t,D[R-1].uv,!0),jl(t,D[R].uv,!0)),W)for(var Q=4*(_.length/3),O=0;3>O;O++)N[--Q]=W[3],N[--Q]=W[2],N[--Q]=W[1],N[--Q]=W[0]}),N.length){for(var M=I.toColorArray(d.csg.color),J=0,U=4*(d.csg.vs.length/3);U>J;J+=4)N[J]==X&&(N[J]=M[0],N[J+1]=M[1],N[J+2]=M[2],N[J+3]=M[3]);d.csg.cs=N}}Ei.forEach(function(q){var n=d[q];n.visible&&n.vs.length?(n.ns&&n.ns.length?b(n,"ns"):n.ns=R(n.vs),b(n,"vs"),b(n,"tuv"),n.cs&&b(n,"cs")):delete d[q]}),C&&(m(d,q,C),d.clear())};N(D,{createFrameModel:function(h,C,k,v){h=h==q?.07:h,C=C==q?h:C,k=k==q?h:k,v=v?v:{};var r=v.top,a=v.bottom,t=v.left,T=v.right,b=v.front,H=v.back,g=[],y=[];return b===!0?(g.push(-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5),y.push(0,0,0,1,1,1,1,1,1,0,0,0)):b===!1||(g.push(-.5,.5,.5,-.5,-.5,.5,-.5+h,-.5,.5,-.5+h,-.5,.5,-.5+h,.5,.5,-.5,.5,.5,.5-h,.5,.5,.5-h,-.5,.5,.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5-h,.5,.5,-.5+h,.5,.5,-.5+h,.5-C,.5,.5-h,.5-C,.5,.5-h,.5-C,.5,.5-h,.5,.5,-.5+h,.5,.5,-.5+h,-.5+C,.5,-.5+h,-.5,.5,.5-h,-.5,.5,.5-h,-.5,.5,.5-h,-.5+C,.5,-.5+h,-.5+C,.5),y.push(0,0,0,1,h,1,h,1,h,0,0,0,1-h,0,1-h,1,1,1,1,1,1,0,1-h,0,h,0,h,C,1-h,C,1-h,C,1-h,0,h,0,h,1-C,h,1,1-h,1,1-h,1,1-h,1-C,h,1-C)),H===!0?(g.push(-.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5),y.push(1,0,0,1,1,1,0,1,1,0,0,0)):H===!1||(g.push(-.5,.5,-.5,-.5+h,-.5,-.5,-.5,-.5,-.5,-.5+h,-.5,-.5,-.5,.5,-.5,-.5+h,.5,-.5,.5-h,.5,-.5,.5,-.5,-.5,.5-h,-.5,-.5,.5,-.5,-.5,.5-h,.5,-.5,.5,.5,-.5,-.5+h,.5,-.5,.5-h,.5-C,-.5,-.5+h,.5-C,-.5,.5-h,.5-C,-.5,-.5+h,.5,-.5,.5-h,.5,-.5,-.5+h,-.5+C,-.5,.5-h,-.5,-.5,-.5+h,-.5,-.5,.5-h,-.5,-.5,-.5+h,-.5+C,-.5,.5-h,-.5+C,-.5),y.push(1,0,1-h,1,1,1,1-h,1,1,0,1-h,0,h,0,0,1,h,1,0,1,h,0,0,0,1-h,0,h,C,1-h,C,h,C,1-h,0,h,0,1-h,1-C,h,1,1-h,1,h,1,1-h,1-C,h,1-C)),t===!0?(g.push(-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5),y.push(0,0,0,1,1,1,1,1,1,0,0,0)):t===!1||(g.push(-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5+k,-.5,-.5,-.5+k,-.5,.5,-.5+k,-.5,.5,-.5,-.5,.5,.5-k,-.5,-.5,.5-k,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,.5-k,-.5,.5,-.5+k,-.5,.5-C,-.5+k,-.5,.5-C,.5-k,-.5,.5-C,.5-k,-.5,.5,.5-k,-.5,.5,-.5+k,-.5,-.5+C,-.5+k,-.5,-.5,-.5+k,-.5,-.5,.5-k,-.5,-.5,.5-k,-.5,-.5+C,.5-k,-.5,-.5+C,-.5+k),y.push(0,0,0,1,k,1,k,1,k,0,0,0,1-k,0,1-k,1,1,1,1,1,1,0,1-k,0,k,0,k,C,1-k,C,1-k,C,1-k,0,k,0,k,1-C,k,1,1-k,1,1-k,1,1-k,1-C,k,1-C)),T===!0?(g.push(.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,.5,.5,.5,-.5,.5,.5,.5),y.push(1,0,0,1,1,1,0,1,1,0,0,0)):T===!1||(g.push(.5,.5,-.5,.5,-.5,-.5+k,.5,-.5,-.5,.5,-.5,-.5+k,.5,.5,-.5,.5,.5,-.5+k,.5,.5,.5-k,.5,-.5,.5,.5,-.5,.5-k,.5,-.5,.5,.5,.5,.5-k,.5,.5,.5,.5,.5,-.5+k,.5,.5-C,.5-k,.5,.5-C,-.5+k,.5,.5-C,.5-k,.5,.5,-.5+k,.5,.5,.5-k,.5,-.5+C,-.5+k,.5,-.5,.5-k,.5,-.5,-.5+k,.5,-.5,.5-k,.5,-.5+C,-.5+k,.5,-.5+C,.5-k),y.push(1,0,1-k,1,1,1,1-k,1,1,0,1-k,0,k,0,0,1,k,1,0,1,k,0,0,0,1-k,0,k,C,1-k,C,k,C,1-k,0,k,0,1-k,1-C,k,1,1-k,1,k,1,1-k,1-C,k,1-C)),r===!0?(g.push(.5,.5,.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5),y.push(1,1,1,0,0,0,0,0,0,1,1,1)):r===!1||(g.push(.5,.5,.5,.5,.5,-.5,.5-h,.5,-.5,.5-h,.5,-.5,.5-h,.5,.5,.5,.5,.5,-.5+h,.5,.5,-.5+h,.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5+h,.5,.5,.5-h,.5,.5,.5-h,.5,.5-k,-.5+h,.5,.5-k,-.5+h,.5,.5-k,-.5+h,.5,.5,.5-h,.5,.5,.5-h,.5,-.5+k,.5-h,.5,-.5,-.5+h,.5,-.5,-.5+h,.5,-.5,-.5+h,.5,-.5+k,.5-h,.5,-.5+k),y.push(1,1,1,0,1-h,0,1-h,0,1-h,1,1,1,h,1,h,0,0,0,0,0,0,1,h,1,1-h,1,1-h,1-k,h,1-k,h,1-k,h,1,1-h,1,1-h,k,1-h,0,h,0,h,0,h,k,1-h,k)),a===!0?(g.push(.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5),y.push(1,0,0,1,1,1,0,1,1,0,0,0)):a===!1||(g.push(.5,-.5,.5,.5-h,-.5,-.5,.5,-.5,-.5,.5-h,-.5,-.5,.5,-.5,.5,.5-h,-.5,.5,-.5+h,-.5,.5,-.5,-.5,-.5,-.5+h,-.5,-.5,-.5,-.5,-.5,-.5+h,-.5,.5,-.5,-.5,.5,.5-h,-.5,.5,-.5+h,-.5,.5-k,.5-h,-.5,.5-k,-.5+h,-.5,.5-k,.5-h,-.5,.5,-.5+h,-.5,.5,.5-h,-.5,-.5+k,-.5+h,-.5,-.5,.5-h,-.5,-.5,-.5+h,-.5,-.5,.5-h,-.5,-.5+k,-.5+h,-.5,-.5+k),y.push(1,0,1-h,1,1,1,1-h,1,1,0,1-h,0,h,0,0,1,h,1,0,1,h,0,0,0,1-h,0,h,k,1-h,k,h,k,1-h,0,h,0,1-h,1-k,h,1,1-h,1,h,1,1-h,1-k,h,1-k)),{vs:g,uv:y}}}),N(z.Style,{"csg.cull.color":X,"csg.cull.box":!0,"dw.flip":!1,"dw.s3":[.999,.999,.5],"dw.t3":X,"dw.expanded":!1,"dw.toggleable":!0,"dw.axis":"left","dw.start":0,"dw.end":B/2,"dw.angle":0,"attach.cull":!1,"attach.operation":"subtract"},!0),Bi.forEach(function(m){var Q={};Q[m+U]=!1,Q[m+".toggleable"]=!1,Q[m+".axis"]=s,Q[m+".start"]=0,Q[m+".end"]=B/2,Q[m+Nh]=0,N(z.Style,Q,!0)});var kf=function(){this.$4n=[]};kf.$15n=function(q){var D=new kf;return D.$4n=q,D},kf.prototype={clone:function(){var G=new kf;return G.$4n=this.$4n.map(function(T){return T.clone()}),G},$19n:function(){return this.$4n},union:function(b){var l=new As(this.clone().$4n),C=new As(b.clone().$4n);return l.$3n(C),C.$3n(l),C.$6n(),C.$3n(l),C.$6n(),l.$7n(C.$2n()),kf.$15n(l.$2n())},subtract:function(k){var x=new As(this.clone().$4n),z=new As(k.clone().$4n);return x.$6n(),x.$3n(z),z.$3n(x),z.$6n(),z.$3n(x),z.$6n(),x.$7n(z.$2n()),x.$6n(),kf.$15n(x.$2n())},intersect:function(N){var _=new As(this.clone().$4n),n=new As(N.clone().$4n);return _.$6n(),n.$3n(_),n.$6n(),_.$3n(n),n.$3n(_),_.$7n(n.$2n()),_.$6n(),kf.$15n(_.$2n())},inverse:function(){var u=this.clone();return u.$4n.map(function(Z){Z.flip()}),u}},kf.cube=function(L){L=L||{};var t=new sn(L.center||[0,0,0]),y=L.radius?L.radius.length?L.radius:[L.radius,L.radius,L.radius]:[1,1,1];return kf.$15n([[[0,4,6,2],[-1,0,0]],[[1,3,7,5],[1,0,0]],[[0,1,5,4],[0,-1,0]],[[2,6,7,3],[0,1,0]],[[0,2,3,1],[0,0,-1]],[[4,5,7,6],[0,0,1]]].map(function(C){return new jc(C[0].map(function(b){var p=new sn(t.x+y[0]*(2*!!(1&b)-1),t.y+y[1]*(2*!!(2&b)-1),t.z+y[2]*(2*!!(4&b)-1));return new Vn(p,new sn(C[1]))}))}))},kf.sphere=function(t){function V(u,O){u*=2*B,O*=B;var r=new sn(K(u)*P(O),K(O),P(u)*P(O));h.push(new Vn(c.$20n(r.$21n(s)),r))}t=t||{};for(var h,c=new sn(t.center||[0,0,0]),s=t.radius||1,q=t.slices||16,x=t.stacks||8,b=[],w=0;q>w;w++)for(var Y=0;x>Y;Y++)h=[],V(w/q,Y/x),Y>0&&V((w+1)/q,Y/x),x-1>Y&&V((w+1)/q,(Y+1)/x),V(w/q,(Y+1)/x),b.push(new jc(h));return kf.$15n(b)},kf.cylinder=function(U){function Z(G,R,f){var F=2*R*B,b=Y.$21n(K(F)).$20n(s.$21n(P(F))),Q=J.$20n(p.$21n(G)).$20n(b.$21n(E)),I=b.$21n(1-T(f)).$20n(q.$21n(f));return new Vn(Q,I)}U=U||{};for(var J=new sn(U.start||[0,-1,0]),i=new sn(U.end||[0,1,0]),p=i.$13n(J),E=U.radius||1,e=U.slices||16,q=p.$14n(),w=T(q.y)>.5,Y=new sn(w,!w,0).cross(q).$14n(),s=Y.cross(q).$14n(),v=new Vn(J,q.$11n()),k=new Vn(i,q.$14n()),c=[],j=0;e>j;j++){var z=j/e,H=(j+1)/e;c.push(new jc([v,Z(0,z,-1),Z(0,H,-1)])),c.push(new jc([Z(0,H,0),Z(0,z,0),Z(1,z,0),Z(1,H,0)])),c.push(new jc([k,Z(1,H,1),Z(1,z,1)]))}return kf.$15n(c)};var sn=function(y,H,q){var B=this;3==arguments.length?(B.x=y,B.y=H,B.z=q):"x"in y?(B.x=y.x,B.y=y.y,B.z=y.z):(B.x=y[0],B.y=y[1],B.z=y[2])};sn.prototype={clone:function(){return new sn(this.x,this.y,this.z)},$11n:function(){return new sn(-this.x,-this.y,-this.z)},$20n:function(N){return new sn(this.x+N.x,this.y+N.y,this.z+N.z)},$13n:function(A){return new sn(this.x-A.x,this.y-A.y,this.z-A.z)},$21n:function(U){return new sn(this.x*U,this.y*U,this.z*U)},$16n:function(T){return new sn(this.x/T,this.y/T,this.z/T)},dot:function(E){return this.x*E.x+this.y*E.y+this.z*E.z},lerp:function(g,b){return this.$20n(g.$13n(this).$21n(b))},length:function(){return y(this.dot(this))},$14n:function(){return this.$16n(this.length())},cross:function(m){var S=this;return new sn(S.y*m.z-S.z*m.y,S.z*m.x-S.x*m.z,S.x*m.y-S.y*m.x)}};var Vn=function(d,N,G){var A=this;A.$24n=new sn(d),A.$22n=N?new sn(N):null,A.uv=G?new sn(G):null};Vn.prototype={clone:function(){var d=this;return new Vn(d.$24n.clone(),d.$22n.clone(),d.uv?d.uv.clone():null)},flip:function(){this.$22n=this.$22n.$11n()},$18n:function(X,O){var C=this;return new Vn(C.$24n.lerp(X.$24n,O),C.$22n.lerp(X.$22n,O),C.uv?C.uv.lerp(X.uv,O):null)}};var Il=function(F,q){this.$22n=F,this.w=q};Il.$17n=function(C,R,J){var k=R.$13n(C).cross(J.$13n(C)).$14n();return new Il(k,k.dot(C))},Il.prototype={clone:function(){return new Il(this.$22n.clone(),this.w)},flip:function(){var K=this;K.$22n=K.$22n.$11n(),K.w=-K.w},$5n:function(m,F,V,D,t){for(var d=this,e=0,y=1,c=2,i=3,U=0,o=[],n=0;n<m.$9n.length;n++){var E=d.$22n.dot(m.$9n[n].$24n)-d.w,W=-u>E?c:E>u?y:e;U|=W,o.push(W)}switch(U){case e:(d.$22n.dot(m.$8n.$22n)>0?F:V).push(m);break;case y:D.push(m);break;case c:t.push(m);break;case i:for(var K=[],z=[],n=0;n<m.$9n.length;n++){var G=(n+1)%m.$9n.length,j=o[n],X=o[G],L=m.$9n[n],r=m.$9n[G];if(j!=c&&K.push(L),j!=y&&z.push(j!=c?L.clone():L),(j|X)==i){var E=(d.w-this.$22n.dot(L.$24n))/d.$22n.dot(r.$24n.$13n(L.$24n)),O=L.$18n(r,E);K.push(O),z.push(O.clone())}}K.length>=3&&D.push(new jc(K,m.$10n)),z.length>=3&&t.push(new jc(z,m.$10n))}}};var jc=function(L,y){var T=this;T.$9n=L,T.$10n=y,T.$8n=Il.$17n(L[0].$24n,L[1].$24n,L[2].$24n)};jc.prototype={clone:function(){var m=this.$9n.map(function($){return $.clone()});return new jc(m,this.$10n)},flip:function(){this.$9n.reverse().map(function(p){p.flip()}),this.$8n.flip()}};var As=function(l){var K=this;K.$8n=null,K.front=null,K.back=null,K.$4n=[],l&&K.$7n(l)};As.prototype={clone:function(){var o=this,l=new As;return l.$8n=o.$8n&&o.$8n.clone(),l.front=o.front&&o.front.clone(),l.back=o.back&&o.back.clone(),l.$4n=o.$4n.map(function(o){return o.clone()}),l},$6n:function(){for(var z=this,R=0;R<z.$4n.length;R++)z.$4n[R].flip();z.$8n&&z.$8n.flip(),z.front&&z.front.$6n(),z.back&&z.back.$6n();var Z=z.front;z.front=z.back,z.back=Z},$1n:function(F){var D=this;if(!D.$8n)return F.slice();for(var n=[],t=[],_=0;_<F.length;_++)D.$8n.$5n(F[_],n,t,n,t);return D.front&&(n=D.front.$1n(n)),t=D.back?D.back.$1n(t):[],n.concat(t)},$3n:function(U){var e=this;e.$4n=U.$1n(e.$4n),e.front&&e.front.$3n(U),e.back&&e.back.$3n(U)},$2n:function(){var t=this,i=t.$4n.slice();return t.front&&(i=i.concat(t.front.$2n())),t.back&&(i=i.concat(t.back.$2n())),i},$7n:function(A){var g=this;if(A.length){g.$8n||(g.$8n=A[0].$8n.clone());for(var x=[],r=[],q=0;q<A.length;q++)this.$8n.$5n(A[q],g.$4n,g.$4n,x,r);x.length&&(g.front||(g.front=new As),this.front.$7n(x)),r.length&&(g.back||(g.back=new As),g.back.$7n(r))}}};var Zf="symbol",Zg=z.Symbol=function(x,$,R){var r=this;J(Zg,r),r.s3(20,20,20),r.s({"all.visible":!1,shape:"rect"}),r.setIcon(x,$,R)};Re("Symbol",k,{setIcon:function(f,N,m){var w,h=this;return Zg.superClass.setIcon.call(h,f),f?(w={for3d:!0,face:"center",position:44,names:[f]},m&&(w.transaprent=!0),N&&(w.autorotate=N),h.addStyleIcon(Zf,w)):h.removeStyleIcon(Zf),h.setWidth(I.getImageWidth(D.getImage(f),h)||20),w}});var Nn=z.CSGNode=function(){J(Nn,this),this.s({shape:"rect","attach.thickness":1.001,"2d.attachable":!0})},Fg={position:1,width:1,height:1,rotation:1,rotationX:1,rotationZ:1,rotationMode:1,tall:1,elevation:1,anchor:1,anchorElevation:1,"s:attach.cull":1,"s:attach.operation":1};Re("CSGNode",k,{_22Q:function(){return sl},onPropertyChanged:function(v){var U=this,S=U.getHost();Nn.superClass.onPropertyChanged.call(U,v),Fg[v.property]&&(S instanceof Ib||S instanceof Nn)&&S.fp("csgNodeChange",!0,!1)}});var sl=function(N,v){J(sl,this,[N,v])};j(sl,g.Node3dUI,{_80o:function(X,F,H){var o=this;o._shape3d?sl.superClass._80o.call(o,X,F,H):(Q(o.gv),Ei.forEach(function(A){l(o,X,F,A,H)}))},validate:function(c,a){var W=this,Z=W.gv,U=W.data;if(U.s("shape3d"))return sl.superClass.validate.call(W,c,a),W._shape3d=!0,void 0;W._shape3d=!1;var q=V(U,Z.getMat(U));U.appendAnchorMatrix3d(q);var K=c&&c.uv;W.vf2("csg",K);for(var r=0;6>r;r++)for(var E=Bi[r],o=Xf[r],Q=W.vf2(E,K,a),S=Q.mat||q,x=Q.vs,R=Q.uv,M=Q.tuv,f=0;2>f;f++){var w=F[o+3*f],v=F[o+3*f+1],C=F[o+3*f+2];if(t(x,S,[A[3*w],A[3*w+1],A[3*w+2]]),t(x,S,[A[3*v],A[3*v+1],A[3*v+2]]),t(x,S,[A[3*C],A[3*C+1],A[3*C+2]]),M)if(R){var b=8*r;M.push(R[2*w-b],R[2*w+1-b],R[2*v-b],R[2*v+1-b],R[2*C-b],R[2*C+1-b])}else M.push(n[2*w],n[2*w+1],n[2*v],n[2*v+1],n[2*C],n[2*C+1])}id(W,c,a)},vf2:function(b,v,t){var g,l=this,A=l.gv.getFaceVisible(l.data,b);return g=d(l,b,t),g.vs=[],g.tuv=A&&(g.texture||v)?[]:q,g.visible=A,g}});var Ib=z.CSGShape=function(){var _=this;J(Ib,_),_.s({"shape.background":q,"2d.hostable":!0,"shape.border.width":8}),_.setTall(240),_.setElevation(120),_.setThickness(14)};Re("CSGShape",x,{IRotatable:!1,_22Q:function(){return Eh},setRotationX:function(){},setRotation:function(){},setRotationZ:function(){},setSegments:function(){}});var Eh=function(A,$){J(Eh,this,[A,$])};j(Eh,g.Shape3dUI,{_80o:function(k,b,J){var o=this;o.undrawable||(Q(o.gv),Ei.forEach(function(G){l(o,k,b,G,J)}))},validate:function(R,M){var N=this,T=N.data,n=T.getPoints();if(N.undrawable=n.size()<2)return N.clear(),void 0;var b=T.isClosePath(),$=i(T._thickness/2,u),X=p(n,q,q,b);Ei.forEach(function(k){N.vf(k,R&&R.uv,!0,M)}),b&&(N.left.visible=!1,N.right.visible=!1),N._12O(X,$),N._20Q(X);var Z=T.getPointsMatrix3d(),S=z.Math.requestVector3();Bi.forEach(function(n){if(N[n])for(var W=N[n].vs,o=0,j=W.length;j>o;o+=3)S.set(W[o],W[o+1],W[o+2]).applyMatrix4(Z),W[o]=S.x,W[o+1]=S.y,W[o+2]=S.z}),z.Math.releaseVector3(S),id(N,R,M)}});var xk=z.DoorWindow=function(){var j=this;J(xk,j),j.setElevation(100),j.s3(100,200,14)};Re("DoorWindow",Nn,{IDoorWindow:!0,toggle:function(w){this.setExpanded(!this.s(a),w)},isExpanded:function(){return this.s(a)},setExpanded:function(y,m){var c=this,p=c.$25n,n=c.getDataModel(),G=c.s(a);if(p&&(p.stop(!0),delete c.$25n),G!==y){n&&n.beginTransaction();var P=y?c.s("dw.end"):c.s("dw.start");c.s(a,y),m=Z(m),m?(G=c.s(xb),m.action=function(u){c.s(xb,G+(P-G)*u)},m.finishFunc=function(){n&&n.endTransaction()},c.$25n=C(m)):(c.s(xb,P),n&&n.endTransaction())}},getMat:function(){var Y=this,S=Y.s("dw.s3"),_=Y.s("dw.t3"),L=Y.s("dw.flip"),p=Y.s(xb);if(S||p||_||L){var y=[];if(L&&y.push({r3:[0,B,0]}),S&&y.push({s3:S}),p){S=Y.getFinalScale3d();var J=Y.s("dw.axis"),d=S[0]/2,H=S[1]/2;S[2]/2,J===s?y.push({t3:[d,0,0]},{r3:[0,-p,0]},{t3:[-d,0,0]}):J===E?y.push({t3:[-d,0,0]},{r3:[0,p,0]},{t3:[d,0,0]}):J===v?y.push({t3:[0,-H,0]},{r3:[-p,0,0]},{t3:[0,H,0]}):J===f?y.push({t3:[0,H,0]},{r3:[p,0,0]},{t3:[0,-H,0]}):J===M?y.push({r3:[0,p,0]}):J===e&&y.push({r3:[p,0,0]})}return _&&y.push({t3:_}),$(y)}return q}});var mr=z.CSGBox=function(){var r=this;J(mr,r),r.setElevation(100),r.s3(100,200,100)};Re("CSGBox",Nn,{ICSGBox:!0,toggleFace:function(i,t){this.setFaceExpanded(i,!this.s(i+U),t)},isFaceExpanded:function(G){return this.s(G+U)},setFaceExpanded:function(W,O,I){var x=this,Y=x.$25n,b=x.s(W+U);if(Y&&(Y.stop(!0),delete x.$25n),b!==O){var k=O?x.s(W+".end"):x.s(W+".start");x.s(W+U,O),I=Z(I),I?(b=x.s(W+Nh),I.action=function(i){x.s(W+Nh,b+(k-b)*i)},x.$25n=C(I)):x.s(W+Nh,k)}},getFaceMat:function(F){var A=this,U=A.s(F+Nh);if(!U)return q;var p,J,Z,c,b,v,h=A.s(F+".axis"),P=A.getFinalScale3d(),s=A.getAnchor3d(),O=P[0]*s.x,V=P[1]*s.y,Q=P[2]*s.z,X=P[0]-O,l=P[1]-V,m=P[2]-Q,T=F+"_"+h;switch(T){case"front_left":p=-O,J=0,Z=m,c=0,b=-U,v=0;break;case"front_right":p=X,J=0,Z=m,c=0,b=U,v=0;break;case"front_top":p=0,J=l,Z=m,c=-U,b=0,v=0;break;case"front_bottom":p=0,J=-V,Z=m,c=U,b=0,v=0;break;case"front_h":p=0,J=0,Z=m,c=U,b=0,v=0;break;case"front_v":p=0,J=0,Z=m,c=0,b=U,v=0;break;case"back_left":p=X,J=0,Z=-Q,c=0,b=-U,v=0;break;case"back_right":p=-O,J=0,Z=-Q,c=0,b=U,v=0;break;case"back_top":p=0,J=l,Z=-Q,c=U,b=0,v=0;break;case"back_bottom":p=0,J=-V,Z=-Q,c=-U,b=0,v=0;break;case"back_h":p=0,J=0,Z=-Q,c=U,b=0,v=0;break;case"back_v":p=0,J=0,Z=-Q,c=0,b=U,v=0;break;case"left_left":p=-O,J=0,Z=-Q,c=0,b=-U,v=0;break;case"left_right":p=-O,J=0,Z=m,c=0,b=U,v=0;break;case"left_top":p=-O,J=l,Z=0,c=0,b=0,v=-U;break;case"left_bottom":p=-O,J=-V,Z=0,c=0,b=0,v=U;break;case"left_h":p=-O,J=0,Z=0,c=0,b=0,v=U;break;case"left_v":p=-O,J=0,Z=0,c=0,b=U,v=0;break;case"right_left":p=X,J=0,Z=m,c=0,b=-U,v=0;break;case"right_right":p=X,J=0,Z=-Q,c=0,b=U,v=0;break;case"right_top":p=X,J=l,Z=0,c=0,b=0,v=U;break;case"right_bottom":p=X,J=-V,Z=0,c=0,b=0,v=-U;break;case"right_h":p=X,J=0,Z=0,c=0,b=0,v=U;break;case"right_v":p=X,J=0,Z=0,c=0,b=U,v=0;break;case"top_left":p=-O,J=l,Z=0,c=0,b=0,v=U;break;case"top_right":p=X,J=l,Z=0,c=0,b=0,v=-U;break;case"top_top":p=0,J=l,Z=-Q,c=-U,b=0,v=0;break;case"top_bottom":p=0,J=l,Z=m,c=U,b=0,v=0;break;case"top_h":p=0,J=l,Z=0,c=U,b=0,v=0;break;case"top_v":p=0,J=l,Z=0,c=0,b=0,v=U;break;case"bottom_left":p=-O,J=-V,Z=0,c=0,b=0,v=-U;break;case"bottom_right":p=X,J=-V,Z=0,c=0,b=0,v=U;break;case"bottom_top":p=0,J=-V,Z=m,c=-U,b=0,v=0;break;case"bottom_bottom":p=0,J=-V,Z=-Q,c=U,b=0,v=0;break;case"bottom_h":p=0,J=-V,Z=0,c=U,b=0,v=0;break;case"bottom_v":p=0,J=-V,Z=0,c=0,b=0,v=U}return $([{t3:[-p,-J,-Z]},{r3:[c,b,v]},{t3:[p,J,Z]}])}});var ms=function(A,T,U,z,q){function w(){var Y,M=[],s=new c,U=new c;for(V.eachShapeModel(function(J,X,n){for(var a=0,i=X?X.length:J.length/3;i>a;a++)X?(s.fromArray(J,3*X[a]),U.fromArray(n,3*X[a])):(s.fromArray(J,3*a),U.fromArray(n,3*a)),b(M,s,U)}),M=k(M,W.set(1,0,0)),M=k(M,W.set(-1,0,0)),M=k(M,W.set(0,1,0)),M=k(M,W.set(0,-1,0)),M=k(M,W.set(0,0,1)),M=k(M,W.set(0,0,-1)),Y=0;Y<M.length;Y++){var N=M[Y];y.push(.5+N.position.x/q.x,.5-N.position.y/q.y),N.position.applyMatrix4(K),I.push(N.position.x,N.position.y,N.position.z),D.push(N.$22n.x,N.$22n.y,N.$22n.z)}}function b(i,b,m){b.applyMatrix4(R),b.applyMatrix4(X),m.transformDirection(R),m.transformDirection(X),i.push(new o(b.clone(),m.clone()))}function k(O,I){for(var k=[],U=.5*Math.abs(q.dot(I)),C=0;C<O.length;C+=3){var R,p,c,K,e,S,H,D=0,B=O[C+0].position.dot(I)-U,d=O[C+1].position.dot(I)-U,Z=O[C+2].position.dot(I)-U;switch(R=B>0,p=d>0,c=Z>0,D=(R?1:0)+(p?1:0)+(c?1:0)){case 0:k.push(O[C]),k.push(O[C+1]),k.push(O[C+2]);break;case 1:if(R&&(K=O[C+1],e=O[C+2],S=l(O[C],K,I,U),H=l(O[C],e,I,U)),p){K=O[C],e=O[C+2],S=l(O[C+1],K,I,U),H=l(O[C+1],e,I,U),k.push(S),k.push(e.clone()),k.push(K.clone()),k.push(e.clone()),k.push(S.clone()),k.push(H);break}c&&(K=O[C],e=O[C+1],S=l(O[C+2],K,I,U),H=l(O[C+2],e,I,U)),k.push(K.clone()),k.push(e.clone()),k.push(S),k.push(H),k.push(S.clone()),k.push(e.clone());break;case 2:R||(K=O[C].clone(),e=l(K,O[C+1],I,U),S=l(K,O[C+2],I,U),k.push(K),k.push(e),k.push(S)),p||(K=O[C+1].clone(),e=l(K,O[C+2],I,U),S=l(K,O[C],I,U),k.push(K),k.push(e),k.push(S)),c||(K=O[C+2].clone(),e=l(K,O[C],I,U),S=l(K,O[C+1],I,U),k.push(K),k.push(e),k.push(S));break;case 3:}}return k}function l(I,G,E,u){var R=I.position.dot(E)-u,U=G.position.dot(E)-u,J=R/(R-U),F=new o(new c(I.position.x+J*(G.position.x-I.position.x),I.position.y+J*(G.position.y-I.position.y),I.position.z+J*(G.position.z-I.position.z)),new c(I.$22n.x+J*(G.$22n.x-I.$22n.x),I.$22n.y+J*(G.$22n.y-I.$22n.y),I.$22n.z+J*(G.$22n.z-I.$22n.z)));return F}var I=[],D=[],y=[],W=new c,V=A.getData3dUI(T);if(V.mat){var R=(new S).fromArray(V.mat),m=new S;m.makeRotationFromEuler(z),m.setPosition(U);var X=(new S).getInverse(m),K=(new S).scale({x:1/q.x,y:1/q.y,z:1/q.z});return w(),{vs:I,ns:D,uv:y}}};o.prototype.clone=function(){return new o(this.position.clone(),this.$22n.clone())};var Dn=function(A,V,L,M){var h=this,B=h.getDataAt(A);if(B){var f=h.intersectObject(A,B);if(f){"object"==typeof V?V=V.x?new c(V.x,V.y,V.z):new c(V[0],V[1],V[2]):(V=V||20,V=new c(V,V,V)),L=L===X?.1:L;var O=new c(h.getUp()),a=new c(h.getCenter()).sub(new c(h.getEye())).normalize(),H="cross",o=a.clone()[H](O).normalize();O.copy(o)[H](a).normalize(),M&&O.applyAxisAngle(f.worldNormal,-M);var D=new z.Node,j=f.worldNormal.clone().setLength(L).add(f.world),p=(new S).lookAt(f.worldNormal.clone(),new c(0,0,0),O),K=(new Y).setFromRotationMatrix(p),m=ms(h,B,f.world.clone(),K,V);return D.p3(j.x,j.y,j.z),D.setEuler(K),D.s3(V.x,V.y,V.z),D.s({shape3d:m,"shape3d.reverse.flip":!0}),D}}};N(z.graph3d.Graph3dView,{createDecal:Dn})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);