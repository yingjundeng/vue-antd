!function(C){"use strict";var Y=C.ht,P=Y.Default,g=P.getInternal(),T=g.ui(),r=null,D="__segmentLengths",Z="__lineTotalLength",W="__linePoints",w="__distance0",n="flow.count",_="flow.step",F="flow.element.max",b="flow.element.count",q="flow.element.min",h="flow.element.space",k="flow.element.autorotate",K="flow.element.background",O="flow.element.shadow.max",m="flow.element.shadow.min",i="flow.element.shadow.begincolor",t="flow.element.shadow.endcolor",I="flow.element.shadow.visible",A="flow.element.image",x="flow",a=Y.Math.Vector2,B=new a;new a,new a,Y.List;var L=Y.Default._edgeProtectMethod,G=L.getStraightLinePoints,Q=function(c,g){for(var f=[],K=c.length,Z=0;K>Z;Z++){var r=c[Z];r._as&&(r=r._as);for(var s=r[0],_=1;_<r.length;_++)f.push([s,r[_]]),s=r[_]}for(var M=[],Z=0;Z<f.length;Z++){var a=o(f[Z][0],f[Z][1],g);M.push(a)}return{distance:M,segments:f}},e=function(E,A,F){if(E){for(var Y,M=Q(E,A),c=M.distance,O=M.segments,e=1/0,i=null,y=0,j=c.length;j>y;y++){var I=c[y];I.z<e&&(Y=y,e=I.z,i=I)}if(null==F&&(F=.1),i.z<F){for(var s=0,q=0;Y>=q;q++)s+=P.getDistance(O[q][0],Y>q?O[q][1]:i);return s}}},o=function(r,d,h){var N=r.x,V=r.y,L=d.x,n=d.y,A=h.x,B=h.y,o=L-N,W=n-V,y=Math.sqrt(o*o+W*W),z=o/y,w=W/y,G=(-N+A)*z+(-V+B)*w,c={x:N+G*z,y:V+G*w};return c.x>=Math.min(r.x,d.x)&&c.x<=Math.max(r.x,d.x)&&c.y>=Math.min(r.y,d.y)&&c.y<=Math.max(r.y,d.y)||(c.x=Math.abs(c.x-r.x)<Math.abs(c.x-d.x)?r.x:d.x,c.y=Math.abs(c.y-r.y)<Math.abs(c.y-d.y)?r.y:d.y),o=A-c.x,W=B-c.y,c.z=Math.sqrt(o*o+W*W),c},y=function(c,R){if(c){var e=Q(c,R).distance,w=1/0,l=null;return e.forEach(function(V){V.z<w&&(w=V.z,l=V)}),l}},l=L.calculateLineLength,v=L.calcSegmentIndexByDistance,V=L.calculatePointAlongLine,p=function(J,t,q){if(!J)return q;if(0===t){var B=J[0][0],K=J[0][1];return q+Math.atan2(K.y-B.y,K.x-B.x)}if(100===t){J=J[J.length-1];var B=J[J.length-2],K=J[J.length-1];return q+Math.atan2(K.y-B.y,K.x-B.x)}for(var W=0,Z=[],N=J.length,C=0;N>C;C++){var c=J[C],f=l(c);W+=f,Z.push(f)}for(var s=W*t/100,X=v(s,Z),d=0,p=0;X>p;p++)d+=Z[p];s-=d;for(var H=V(J[X],s),Y=J[X],e=0,$=0,T=0;T<Y.length-1;T++){var P=Y[T],i=Y[T+1],h=i.x-P.x,E=i.y-P.y,F=Math.sqrt(h*h+E*E);if(e+=F,e>s){$=T;break}}var Q=Y[$];return q+Math.atan2(H.y-Q.y,H.x-Q.x)},z=function(G){var w=0;if(G)if(Array.isArray(G[0]))for(var f=G.length,H=0;f>H;H++){var Q=G[H],u=l(Q);w+=u}else w=l(G);return w},j=function(s,A,k,m){return B.set(A,k).rotateAround(null,m),s?{x:s.x+B.x,y:s.y+B.y}:{x:B.x,y:B.y}},d=function(x){var M=x._data,o=G(x);if(o){M.s("flow.reverse")&&(o.reverse(),o.forEach(function(i){i.reverse()}));for(var w=0,e=[],O=o.length,a=0;O>a;a++){var p=o[a],R=l(p);w+=R,e.push(R)}if(M[D]=e,M[Z]=w,M[W]=o,M instanceof Y.Edge){var S=P.unionPoint(o),c=S.x+S.width/2,T=S.y+S.height/2;M.$10e={x:c,y:T}}f(x,!0)}},M=L.getPercentPosition,f=function(U,e){var f=U._data,z=f[Z],L=f.s(n),y=f.s(_),$=0,A=f[D],l=f.s(F),t=f.s(q),Q=f.s(b),c=(l-t)/(Q-1),g=[];if(A){if(1===Q)g.push(l);else if(2===Q)g.push(l),g.push(t);else{if(!(Q>2))return;g.push(l);for(var V=Q-2;V>0;V--)g.push(t+c*V);g.push(t)}var u=0,x=0;g.forEach(function(d){Q-1>u&&(x+=f.getFlowElementSpace(d)),u++}),x+=(l+t)/2,$=(z-L*x+x)/L;var k=U[w];for(null==k&&(k=0),e||(k+=y);k>z+x;){var I=U._overCount;I?I++:I=1,I>=L&&(I=null),U._overCount=I,f.s("flow.autoreverse")?I?k-=$+x:(k=0,f.s("flow.reverse",!f.s("flow.reverse"))):k-=$+x}U[w]=k}},c="prototype",U=Y.graph.GraphView[c],R=Y.Data[c],s=T.DataUI[c],E=T.ShapeUI[c],X=T.EdgeUI[c],u=Y.DataModel[c],$=Y.Style;$[F]==r&&($[F]=7),$[q]==r&&($[q]=0),$[n]==r&&($[n]=1),$[_]==r&&($[_]=3),$[b]==r&&($[b]=10),$[h]==r&&($[h]=3.5),$[k]==r&&($[k]=!1),$[K]==r&&($[K]="rgba(255, 255, 114, 0.4)"),$[i]==r&&($[i]="rgba(255, 255, 0, 0.3)"),$[t]==r&&($[t]="rgba(255, 255, 0, 0)"),$[I]==r&&($[I]=1),$[O]==r&&($[O]=22),$[m]==r&&($[m]=4),U.calculatePointLength=function(E,p,B){var L=this.getDataUI(E),J=G(L);return e(J,p,B)},P.calculatePointLength=function(k,L,$,Z){var u=G(r,k,L);return e(u,$,Z)},P.calculateClosestPointOnLine=o,U.calculateClosestPoint=function(x,w){var E=this.getDataUI(x),B=G(E);return y(B,w)},P.calculateClosestPoint=function(g,P,W){var b=G(r,g,P);return y(b,W)},U.getPercentAngle=function(I,U){var y=this.getDataUI(I),x=G(y);return I.getRotation?I.getRotation():0,p(x,U,I.getRotation?I.getRotation():0)},P.getPercentAngle=function(A,c,i){var P=G(r,A,c);return p(P,i,0)},U.calculateLength=function(C){var f=this.getDataUI(C),o=G(f);return z(o)},P.calculateLength=function(u,y){var o=G(r,u,y);return z(o)},U.getPercentPosition=function(P,L){var N=this.getDataUI(P),A=G(N);return M(A,L)},P.getPercentPositionOnPoints=function(L,j,e){var c=G(r,L,j);return M(c,e)};var S=function(r){var y=r.data,W=this.dm();if(y&&"add"===r.kind){var M=W.$3e;M&&y.s(x)&&M.indexOf(y)<0&&M.push(y)}"clear"===r.kind&&(W.$3e=[])},N=function(q){var C=q.property,$=q.data,k=q.newValue,r=this.dm().$3e;if(r&&"s:flow"===C)if(k)r.indexOf($)<0&&r.push($);else for(var E=r.length,P=0;E>P;P++)if(r[P]===$){r.splice(P,1);break}},H=U.setDataModel;U.setDataModel=function(A){var L=this,w=L._dataModel;if(w!==A){w&&(w.umm(S,L),w.umd(N,L),w.$3e=[]),A.mm(S,L),A.md(N,L);var v=A.$3e=[];A.each(function(Z){Z.s(x)&&v.indexOf(Z)<0&&v.push(Z)}),H.call(L,A)}},R.getFlowElementSpace=function(){return this.s(h)};var J=function(o){var t=this,P=t._data,X=P[Z],h=P[D],x=P[W],z=P.s(n),J=0,R=t[w],M=P.s(F),I=P.s(q),$=P.s(b),Y=P.s(m),s=P.s(O),C=P.s(k),E=(s-Y)/($-1),u=(M-I)/($-1),d=P.getRotation?P.getRotation():0,A=P.getPosition?P.p():P.$10e,y=[],l=[];if(R!=r){if(1===$)y.push(M);else if(2===$)y.push(M),y.push(I);else{if(!($>2))return;y.push(M);for(var H=$-2;H>0;H--)y.push(I+u*H);y.push(I)}if(1===$)l.push(s);else if(2===$)l.push(s),l.push(Y);else{if(!($>2))return;l.push(s);for(var H=$-2;H>0;H--)l.push(Y+E*H);l.push(Y)}var K=0,B=0;y.forEach(function(V){$-1>K&&(B+=P.getFlowElementSpace(V)),K++}),B+=(M+I)/2,J=(X-z*B+B)/z,o.save();for(var H=0;z>H;H++){var L=R,T=0,f=t._overCount,N=0;P.s("flow.autoreverse")&&f&&f>z-(H+1)||(L-=H*(J+B),K=0,y.forEach(function(G){var I=L-T;if(I>=0&&X>I){var W=!0,U=v(I,h);N=0;for(var a=0;U>a;a++)N+=h[a];if(I-=N,W){var $=V(x[U],I),Q=d;if(C){for(var Z=x[U],g=0,p=0,z=0;z<Z.length-1;z++){var q=Z[z],b=Z[z+1],e=b.x-q.x,R=b.y-q.y,w=Math.sqrt(e*e+R*R);if(g+=w,g>I){p=z;break}}var J=Z[p];Q+=Math.atan2($.y-J.y,$.x-J.x)}d&&($=j(A,$.x-A.x,$.y-A.y,d)),t.$5e(o,$,G,l[K],Q)}}T+=P.getFlowElementSpace(y[K]),K++}))}o.restore()}},Jf=X._80o;X._80o=function(f){Jf.call(this,f);var u=this,G=u._data,z=u.gv;G.s(x)&&z.$7e!=r&&J.call(u,f)};var Br=E._80o;E._80o=function(l){Br.call(this,l);var P=this,Y=P._data,L=P.gv;Y.s(x)&&L.$7e!=r&&J.call(P,l)};var Ge=X._79o,ie=E._79o,Hd=function(){var H=this,m=H._data,R=m.s(F),s=!1,v=r;if(H._6I||(s=!0),v=m instanceof Y.Edge?Ge.call(H):ie.call(H),m.s(x)&&s){var M=m.s(O),b=m.s(I);b&&M>R&&(R=M),R>0&&P.grow(v,Math.ceil(R/2)),d(H)}return!m.s(x)&&s&&(m[D]=m[Z]=m[W]=H[w]=r),v};E._79o=Hd,X._79o=Hd,s.$5e=function(X,Q,o,Y,S){var l=this,e=l._data,_=l.gv,z=e.s(K),E=e.s(i),x=e.s(t),s=e.s(I),d=_.$8e,G=e.s(A);if(d==r&&(d=_.$8e={}),X.beginPath(),G!=r){var W=P.getImage(G),k=o/2;X.translate(Q.x,Q.y),X.rotate(S),X.translate(-Q.x,-Q.y),P.drawImage(X,W,Q.x-k,Q.y-k,o,o,e),X.translate(Q.x,Q.y),X.rotate(-S),X.translate(-Q.x,-Q.y)}else if(_.__flowBatch){var b=_.__flowBatchGroup;b||(b=_.__flowBatchGroup={});var R=[Q.x,Q.y,o/2];b[z]?b[z].push(R):b[z]=[R]}else X.fillStyle=z,X.arc(Q.x,Q.y,o/2,0,2*Math.PI,!0),X.fill();if(s){var H=22,f=H+"_"+E+"_"+x,N=d[f];if(N==r){var p=document.createElement("canvas");g.setCanvas(p,H,H);var M=p.getContext("2d"),m=H/2,J=m,n=m;g.translateAndScale(M,0,0,1),M.beginPath();var $=M.createRadialGradient(J,n,0,J,J,m);$.addColorStop(0,E),$.addColorStop(1,x),M.fillStyle=$,M.arc(J,n,m,0,2*Math.PI,!0),M.fill(),N=d[f]=p}var k=Y/2;P.drawImage(X,N,Q.x-k,Q.y-k,Y,Y,e)}},U.$9e=function(){var n=this,K=n.dm().$3e;n._24I,K.forEach(function(N){n._24I[N._id]=N}),n.iv()};var rr=u.prepareRemove;u.prepareRemove=function(U){rr.call(this,U);var F=U._dataModel,d=F.$3e;if(d)for(var T=d.length,v=0;T>v;v++)if(d[v]===U){d.splice(v,1);break}},U.setFlowInterval=function(J){var Y=this,n=Y.$11e;Y.$11e=J,Y.fp("flowInterval",n,J),Y.$7e!=r&&(clearInterval(Y.$7e),delete Y.$7e,Y.enableFlow(J))},U.getFlowInterval=function(){return this.$11e},U.enableFlow=function(t){var c=this,D=c.dm(),B=D.$3e;c.$7e==r&&(B.forEach(function($){var F=c.getDataUI($);d(F)}),c.$7e=setInterval(function(){D.$3e.forEach(function(V){f(c.getDataUI(V))}),c.$9e()},t||c.$11e||50))},U.disableFlow=function(){var $=this;clearInterval($.$7e),delete $.$7e;var M=$.dm().$3e;M&&$.$9e()};var Wn=function(){this.__flowBatchGroup={}},kj=function(E){var y=this.__flowBatchGroup;if(y){E.save();for(var J in y){E.fillStyle=J,E.beginPath();var Z=y[J];Z.forEach(function(r){E.moveTo(r[0],r[1]),E.arc(r[0],r[1],r[2],0,2*Math.PI,!0)}),E.fill()}E.restore()}};U.setFlowBatch=function(g){var Z=this;!!Z.__flowBatch!=!!g&&(Z.__flowBatch=g,g?(Z.addBottomPainter(Wn),Z.addTopPainter(kj)):(Z.removeBottomPainter(Wn),Z.removeTopPainter(kj)))}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);