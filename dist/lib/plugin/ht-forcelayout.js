!function(F,D){"use strict";var L="ht",l=L+".layout.",Y=F[L]||module.parent.exports.ht,A=Y.List,V=Y.DataModel,j=Y.Node,B=Y.Edge,k=Y.Group,g=Math,q=g.sqrt,o=g.random,u=g.max,J=g.min,f=function(j){return j*j};Y.Default.getInternal().addMSMap({ms_force:function(P){P._interval=50,P._stepCount=10,P._motionLimit=.01,P._edgeRepulsion=.65,P._nodeRepulsion=.65,P._damper=1,P._maxMotion=0,P._motionRatio=0,P.init=function(u){var B=this;u instanceof V?B.dm=u:B.gv=u,B._nodeMap={},B._nodes=new A,B._edges=new A},P.start=function(){var J=this,s=J.gv;if(!J._timer){var O=J.cdm=s?s.dm():J.dm;O.mm(J.handleDataModelChange,J),O.md(J.handleDataPropertyChange,J),s&&s.mp(J.handleGV,J),O.each(function(y){if(J.isVisible(y)&&J.isLayoutable(y)&&y instanceof j)if(J instanceof d){var N=y.p3();y.p3([N[0]+o(),N[1]+o(),N[2]+o()])}else N=y.p(),y.p(N.x+o(),N.y+o())}),J._timer=setInterval(function(){J.relax()},J._interval),J._damper=1}},P.stop=function(){var h=this;h._timer&&(h.cdm.umm(h.handleDataModelChange,h),h.cdm.umd(h.handleDataPropertyChange,h),h.gv&&h.gv.ump(h.handleGV,h),clearInterval(h._timer),delete h._timer,delete h.cdm)},P.handleGV=function(T){var I=this;if("dataModel"===T.property){var n=T.oldValue,j=T.newValue;n&&(n.umm(I.handleDataModelChange,I),n.umd(I.handleDataPropertyChange,I)),this.cdm=j,j.mm(I.handleDataModelChange,I),j.md(I.handleDataPropertyChange,I)}},P.relax=function(){var G=this;if(!(G._damper<.1&&G._maxMotion<G._motionLimit)){this.cdm.each(function(C){G.isVisible(C)&&(C instanceof B?G.addEdge(C):C instanceof j&&G.addNode(C))});for(var Y,Z,g=0,m=G._edges,L=G._nodes,T=L.size();g<G._stepCount;g++){for(m.each(G.relaxEdge,G),Y=0;T>Y;Y++)for(Z=0;T>Z;Z++)G.relaxNode(L.get(Y),L.get(Z));G.moveNode()}G._isAdjusting=1,L.each(function(W){W.fix||(W.p?W.v.p3(W.p):W.v.p(W.x,W.y))}),delete G._isAdjusting,G._nodeMap={},L.clear(),m.clear(),G.onRelaxed()}},P.onRelaxed=function(){},P.isRunning=function(){return!!this._timer},P.isVisible=function($){return $.s("layoutable")===!1?!1:this.gv?this.gv.isVisible($):!0},P.isLayoutable=function(M){if(M.s("layoutable")===!1)return!1;if(M instanceof k)return!1;var z=this;return z.gv?z.gv.isMovable(M)&&!z.gv.isSelected(M):!(z.cdm||z.dm).sm().co(M)},P.getNodeRepulsion=function(){return this._nodeRepulsion},P.setNodeRepulsion=function(B){this._nodeRepulsion=B,this._damper=1},P.getEdgeRepulsion=function(){return this._edgeRepulsion},P.setEdgeRepulsion=function(R){this._edgeRepulsion=R,this._damper=1},P.getStepCount=function(){return this._stepCount},P.setStepCount=function(E){this._stepCount=E,this._damper=1},P.getInterval=function(){return this._interval},P.setInterval=function(q){var O=this;O._interval!==q&&(O._interval=q,O._timer&&(clearInterval(O._timer),O._timer=setInterval(function(){O.relax()},q)))},P.handleDataPropertyChange=function(o){!this._isAdjusting&&this.isVisible(o.data)&&(this._damper=1)},P.handleDataModelChange=function(){this._damper=1},P.damp=function(){var D=this._maxMotion,w=this._damper;this._motionRatio<=.001&&((.2>D||D>1&&.9>w)&&w>.01?this._damper-=.01:.4>D&&w>.003?this._damper-=.003:w>1e-4&&(this._damper-=1e-4)),D<this._motionLimit&&(this._damper=0)}}}),Y.layout.ForceLayout=function(O){this.init(O)},Y.Default.def(l+"ForceLayout",D,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(q){this._limitBounds=q,this._damper=1},getNodeSize:function(S){var l=this.gv;return l&&l.getDataUIBounds?l.getDataUIBounds(S):S.getRect()},addNode:function(v){var i=this,e=i._nodeMap[v._id];if(e)return e;var N=v.p();e={v:v,x:N.x,y:N.y,dx:0,dy:0,fix:!i.isLayoutable(v),s:i.getNodeSize(v)};var A=e.s,Q=q(f(A.width)+f(A.height))*i._nodeRepulsion;return e.r=1>Q?100:Q,i._nodeMap[v._id]=e,i._nodes.add(e),e},addEdge:function(k){if(k._40I&&k._41I){var A=this,h=A.addNode(k._40I),T=A.addNode(k._41I),W={s:h,t:T};T=T.s,h=h.s;var d=T.width+h.width,b=T.height+h.height;W.length=q(d*d+b*b)*A._edgeRepulsion,W.length<=0&&(W.length=100),A._edges.add(W)}},relaxEdge:function(h){var k=h.t,I=h.s,w=k.x-I.x,E=k.y-I.y,H=q(w*w+E*E),i=100*h.length,j=.25*w/i*H,N=.25*E/i*H;k.dx=k.dx-j,k.dy=k.dy-N,I.dx=I.dx+j,I.dy=I.dy+N},relaxNode:function(b,z){if(b!==z){var f=0,r=0,t=b.x-z.x,k=b.y-z.y,q=t*t+k*k;0===q?(f=o(),r=o()):36e4>q&&(f=t/q,r=k/q);var M=b.r*z.r/400;f*=M,r*=M,b.dx+=f,b.dy+=r,z.dx-=f,z.dy-=r}},moveNode:function(){var o=this,N=o._limitBounds,y=o._maxMotion,R=0,H=o._damper;o._nodes.each(function(G){if(!G.fix){var O=G.dx*H,A=G.dy*H;if(G.dx=O/2,G.dy=A/2,R=u(q(O*O+A*A),R),G.x+=u(-40,J(40,O)),G.y+=u(-40,J(40,A)),N){G.x<N.x&&(G.x=N.x,o.adjust(1,0)),G.y<N.y&&(G.y=N.y,o.adjust(0,1));var a=G.s;G.x+a.width>N.x+N.width&&(G.x=N.x+N.width-a.width,o.adjust(-1,0)),G.y+a.height>N.y+N.height&&(G.y=N.y+N.height-a.height,o.adjust(0,-1))}}}),o._maxMotion=R,o._motionRatio=R>0?y/R-1:0,o.damp()},adjust:function(E,R){var A=this._limitBounds;this._nodes.each(function(w){E>0?(!A||w.x+w.s.width+E<A.x+A.width)&&(w.x+=E):(!A||w.x+E>A.x)&&(w.x+=E),R>0?(!A||w.y+w.s.height+R<A.y+A.height)&&(w.y+=R):(!A||w.y+R>A.y)&&(w.y+=R)})}});var d=Y.layout.Force3dLayout=function(t){this.init(t)};Y.Default.def(l+"Force3dLayout",D,{ms_force:1,getNodeSize3d:function(A){return A.s3()},addNode:function(l){var P=this,O=P._nodeMap[l._id];if(O)return O;O={v:l,p:l.p3(),d:[0,0,0],fix:!P.isLayoutable(l),s:P.getNodeSize3d(l)};var H=O.s,Z=Y.Default.getDistance(H)*P._nodeRepulsion;return O.r=1>Z?100:Z,P._nodeMap[l._id]=O,P._nodes.add(O),O},addEdge:function(m){if(m._40I&&m._41I){var M=this,S=M.addNode(m._40I),K=M.addNode(m._41I),t={s:S,t:K};K=K.s,S=S.s,t.length=q(f(K[0]+S[0])+f(K[1]+S[1])+f(K[2]+S[2]))*M._edgeRepulsion,t.length<=0&&(t.length=100),M._edges.add(t)}},relaxEdge:function(f){var u=f.t.p,V=f.s.p,B=f.t.d,A=f.s.d,c=u[0]-V[0],g=u[1]-V[1],J=u[2]-V[2],p=q(c*c+g*g+J*J),r=100*f.length,i=.25*c/r*p,P=.25*g/r*p,H=.25*J/r*p;B[0]-=i,B[1]-=P,B[2]-=H,A[0]+=i,A[1]+=P,A[2]+=H},relaxNode:function($,M){if($!==M){var y=$.p,V=M.p,s=0,I=0,u=0,g=y[0]-V[0],O=y[1]-V[1],T=y[2]-V[2],d=g*g+O*O+T*T;0===d?(s=o(),I=o(),u=o()):216e6>d&&(s=g/d,I=O/d,u=T/d);var c=$.r*M.r/400,v=$.d,H=M.d;s*=c,I*=c,u*=c,v[0]+=s,v[1]+=I,v[2]+=u,H[0]-=s,H[1]-=I,H[2]-=u}},moveNode:function(){var l=this,Q=l._maxMotion,F=0,d=l._damper;l._nodes.each(function(I){if(!I.fix){var Z=I.p,t=I.d,o=t[0]*d,B=t[1]*d,e=t[2]*d;t[0]=o/2,t[1]=B/2,t[2]=e/2,F=u(q(o*o+B*B+e*e),F),Z[0]+=u(-40,J(40,o)),Z[1]+=u(-40,J(40,B)),Z[2]+=u(-40,J(40,e))}}),l._maxMotion=F,l._motionRatio=F>0?Q/F-1:0,l.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);