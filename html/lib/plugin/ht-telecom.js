!function(S,_){"use strict";var g=ht.AlarmSeverity=function(b,P,a,u,z){this.value=b,this.name=P,this.nickName=a,this.color=u,this.displayName=z};ht.Default.def("ht.AlarmSeverity",_,{toString:function(){return this.displayName||this.name}}),function(){g.severities=new ht.List,g._vm={},g._nm={},g._cp=function(N,q){if(N&&q){var t=N.value-q.value;return t>0?1:0>t?-1:0}return N&&!q?1:!N&&q?-1:0},g.each=function(f,L){g.severities.each(f,L)},g.getSortFunction=function(){return g._cp},g.setSortFunction=function(q){g._cp=q,g.severities.sort(q)},g.add=function(K,X,x,k,u){var F=new g(K,X,x,k,u);return g._vm[K]=F,g._nm[X]=F,g.severities.add(F),g.severities.sort(g._cp),F},g.remove=function(E){var b=g._nm[E];return b&&(delete g._nm[E],delete g._vm[b.value],g.severities.remove(b)),b},g.CRITICAL=g.add(500,"Critical","C","#FF0000"),g.MAJOR=g.add(400,"Major","M","#FFA000"),g.MINOR=g.add(300,"Minor","m","#FFFF00"),g.WARNING=g.add(200,"Warning","W","#00FFFF"),g.INDETERMINATE=g.add(100,"Indeterminate","N","#C800FF"),g.CLEARED=g.add(0,"Cleared","R","#00FF00"),g.isClearedAlarmSeverity=function(p){return p?0===p.value:!1},g.getByName=function(o){return g._nm[o]},g.getByValue=function(x){return g._vm[x]},g.clear=function(){g.severities.clear(),g._vm={},g._nm={}},g.compare=function(f,B){return g._cp(f,B)}}();var v=ht.AlarmState=function(o){this._d=o,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",_,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var h=null;for(var n in this._am)n=g.getByName(n),g.isClearedAlarmSeverity(n)||0!==this.getAcknowledgedAlarmCount(n)&&(h=h?g.compare(h,n)>0?h:n:n);this._haa=h},_c2:function(){var N=null;for(var t in this._nm)t=g.getByName(t),g.isClearedAlarmSeverity(t)||0!==this.getNewAlarmCount(t)&&(N=N?g.compare(N,t)>0?N:t:t);this._hna=N},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var a in this._nm)if(a=g.getByName(a),!g.isClearedAlarmSeverity(a)&&0!==this.getNewAlarmCount(a)&&g.compare(this._hna,a)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var r=this._haa,P=this._hna,k=this._ps;this._hoa=r,g.compare(P,this._hoa)>0&&(this._hoa=P),g.compare(k,this._hoa)>0&&(this._hoa=k)},_c5:function(){var h=this._haa,X=this._hna;this._hta=h,g.compare(X,this._hta)>0&&(this._hta=X)},increaseAcknowledgedAlarm:function(C,S){if(0!==S){S=S||1;var l=this._am[C.name]||0;l+=S,this._am[C.name]=l,this._f()}},increaseNewAlarm:function(v,i){if(0!==i){i=i||1;var P=this._nm[v.name]||0;P+=i,this._nm[v.name]=P,this._f()}},decreaseAcknowledgedAlarm:function(S,x){if(0!==x){x||(x=1);var u=this._am[S.name]||0;if(u-=x,0>u)throw"Alarm count can not be negative";this._am[S.name]=u,this._f()}},decreaseNewAlarm:function(t,u){if(0!==u){u||(u=1);var n=this._nm[t.name]||0;if(n-=u,0>n)throw"Alarm count can not be negative";this._nm[t.name]=n,this._f()}},acknowledgeAlarm:function(f){this.decreaseNewAlarm(f,1),this.increaseAcknowledgedAlarm(f,1)},acknowledgeAllAlarms:function(d){if(d){var R=this.getNewAlarmCount(d);this.decreaseNewAlarm(d,R),this.increaseAcknowledgedAlarm(d,R)}else for(var N in this._nm)this.acknowledgeAllAlarms(g.getByName(N))},_c6:function(){this._aac=0;for(var f in this._am)f=g.getByName(f),this._aac+=this.getAcknowledgedAlarmCount(f)},getAcknowledgedAlarmCount:function(h){return h?this._am[h.name]||0:this._aac},getAlarmCount:function(h){return this.getAcknowledgedAlarmCount(h)+this.getNewAlarmCount(h)},_c7:function(){this._nac=0;for(var F in this._nm)this._nac+=this.getNewAlarmCount(g.getByName(F))},getNewAlarmCount:function(r){return r?this._nm[r.name]||0:this._nac},setNewAlarmCount:function(u,J){this._nm[u.name]=J,this._f()},removeAllNewAlarms:function(b){b?delete this._nm[b]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(_,b){this._am[_.name]=b,this._f()},removeAllAcknowledgedAlarms:function(_){_?delete this._am[_.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(x){if(this._ep||(x=null),this._ps!==x){var B=this._ps;this._ps=x,this._f(),this._d.fp("propagateSeverity",B,x)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(y){var h=this._ep;this._ep=y,this._d.fp("enablePropagation",h,y)&&(y||this.setPropagateSeverity(null))}});var O=ht.AlarmStatePropagator=function(R){this._dataModel=R,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",_,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(Z){this._enable!==Z&&(this._enable=Z,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(i){this.propagate(i)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(l){l.data&&this.propagate(l.data)},handleDataPropertyChange:function(V){if("alarmState"===V.property||"enablePropagation"===V.property)this.propagate(V.data);else if("parent"===V.property){var O=V.oldValue;O&&this.propagate(O),this.propagate(V.data)}},propagate:function(F){F&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(F),this._isPropagating=!1)},propagateToTop:function(I){for(this.propagateToParent(null,I);I&&I.getParent();)this.propagateToParent(I,I.getParent()),I=I.getParent()},propagateToParent:function(c,t){var N=null;t.getChildren().each(function(y){var J=y.getAlarmState().getHighestOverallAlarmSeverity();g.compare(J,N)>0&&(N=J)}),t.getAlarmState().setPropagateSeverity(N)}}),ht.AlarmStateStatistics=function(c){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(c)},ht.Default.def("ht.AlarmStateStatistics",_,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(V){var n=this._dataModel;n!==V&&(n&&(n.umd(this.handleDataPropertyChange,this),n.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=V,this.reset(),V.md(this.handleDataPropertyChange,this),V.mm(this.handleDataModelChange,this),this.fp("dataModel",n,V))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(N){"alarmState"===N.property&&(this.increase(N.data),this.fireAlarmStateChange())},handleDataModelChange:function(A){"add"===A.kind?(this.increase(A.data),this.fireAlarmStateChange()):"remove"===A.kind?(this.decrease(A.data),this.fireAlarmStateChange()):"clear"===A.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,g.each(function(s){var q=this.getSumInfo(s);this.sumAcked+=q.ackedCount,this.sumNew+=q.newCount,this.sumTotal+=q.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(S){if(!S)return this.sumNew;var M=this.getSumInfo(S);return M.newCount},getAcknowledgedAlarmCount:function(R){if(!R)return this.sumAcked;var M=this.getSumInfo(R);return M.ackedCount},getTotalAlarmCount:function(e){if(!e)return this.sumTotal;var j=this.getSumInfo(e);return j.totalCount},getSumInfo:function(s){var H=this.severtiyMap[s.name];return H||(H={},H.newCount=0,H.ackedCount=0,H.totalCount=0,this.severtiyMap[s.name]=H),H},decrease:function(Q){var l=this.dataMap[Q.getId()];l&&(delete this.dataMap[Q.getId()],g.each(function(m){var x=l[m.name],b=this.getSumInfo(m);b.newCount=b.newCount-x.newCount,b.ackedCount=b.ackedCount-x.ackedCount,b.totalCount=b.totalCount-x.totalCount},this))},increase:function(n){if(this.decrease(n),!this._filterFunc||this._filterFunc(n)){var o={},B=n.getAlarmState();this.dataMap[n.getId()]=o,g.each(function(Y){var R={};R.newCount=B.getNewAlarmCount(Y),R.ackedCount=B.getAcknowledgedAlarmCount(Y),R.totalCount=B.getAlarmCount(Y),o[Y.name]=R;var q=this.getSumInfo(Y);q.newCount=q.newCount+R.newCount,q.ackedCount=q.ackedCount+R.ackedCount,q.totalCount=q.totalCount+R.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(U){var I=this._filterFunc;this._filterFunc=U,this.reset(),this.fp("filterFunc",I,U)},getFilterFunc:function(){return this._filterFunc}});var N=ht.Data.prototype;N.getAlarmState=function(){return this._alarmState||(this._alarmState=new v(this))},N=ht.DataModel.prototype,N.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},N.setEnableAlarmStatePropagator=function(h){h!=this.isEnableAlarmStatePropagator()&&(h?(this._alarmStatePropagator=new O(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},N=ht.graph.GraphView.prototype,N.getNote2=function(U){var p=U.getAlarmState().getHighestNewAlarmSeverity();if(p){var w=U.getAlarmState().getNewAlarmCount(p)+p.nickName;return U.getAlarmState().hasLessSevereNewAlarms()&&(w+="+"),w}return U.s("note2")},N.getNote2Background=function(U){var d=U.getAlarmState().getHighestNewAlarmSeverity();return d?d.color:U.s("note2.background")},N.getBodyColor=function(O){var l=O.getAlarmState().getHighestNativeAlarmSeverity();return l?l.color:O.s("body.color")},N.getBorderColor=function(s){var y=s.getAlarmState().getPropagateSeverity();return y?y.color:s.s("border.color")},N=ht.widget.TreeView.prototype,N.getBorderColor=function(K){var s=K.getAlarmState().getPropagateSeverity();return s?s.color:K.s("border.color")},N.getIcon=function(U){return U.getIcon()?"__alarmIcon__":null},N=ht.widget.TreeTableView.prototype,N.getBorderColor=function(p){var u=p.getAlarmState().getPropagateSeverity();return u?u.color:p.s("border.color")},N.getIcon=function(G){return G.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(E){return E.getIcon()}},color:{func:function(U){var K=U.getAlarmState().getHighestNativeAlarmSeverity();return K?K.color:U.s("body.color")}},rect:[0,0,16,16]}]});var u=ht.Style;u["note2.expanded"]=!0,u["note2.color"]="#000"}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);