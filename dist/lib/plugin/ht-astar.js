!function(n,w,x){"use strict";var c=n.ht;c.Astar={},function(G){var E=G();n.AStar=E.astar,n.AStar.Graph=E.Graph}(function(){function k(Z){for(var M=Z,D=[];M.parent;)D.unshift(M),M=M.parent;return D}function B(){return new L(function(S){return S.f})}function o(p,x){x=x||{},this.nodes=[],this.diagonal=!!x.diagonal,this.grid=[];for(var D=0;D<p.length;D++){this.grid[D]=[];for(var z=0,j=p[D];z<j.length;z++){var U=new r(D,z,j[z]);this.grid[D][z]=U,this.nodes.push(U)}}this.$13x()}function r(N,L,v){this.x=N,this.y=L,this.weight=v}function L(P){this.content=[],this.scoreFunction=P}var p={search:function(t,a,L,e){t.$6x(),e=e||{};var h=e.heuristic;h||(h=t.diagonal?p.$4x.diagonal:p.$4x.manhattan);var O=e.closest||!1,u=e.punish,V=B(),m=a;for(a.h=h(a,L),t.$7x(a),V.push(a);V.size()>0;){var Z=V.pop();if(Z===L)return k(Z);Z.closed=!0;for(var N=t.neighbors(Z),$=0,A=N.length;A>$;++$){var S=N[$];if(!S.closed&&!S.$9x()){var r=Z.g+S.getCost(Z,u),H=S.visited;(!H||r<S.g)&&(S.visited=!0,S.parent=Z,S.h=S.h||h(S,L),S.g=r,S.f=S.g+S.h,t.$7x(S),O&&(S.h<m.h||S.h===m.h&&S.g<m.g)&&(m=S),H?V.$10x(S):V.push(S))}}}return O?k(m):[]},$4x:{manhattan:function(b,v){var n=Math.abs(v.x-b.x),z=Math.abs(v.y-b.y);return n+z},diagonal:function(q,t){var i=1,N=Math.sqrt(2),b=Math.abs(t.x-q.x),G=Math.abs(t.y-q.y);return i*(b+G)+(N-2*i)*Math.min(b,G)}},$5x:function(O){O.f=0,O.g=0,O.h=0,O.visited=!1,O.closed=!1,O.parent=null}};return o.prototype.$13x=function(){this.dirtyNodes=[];for(var R=0;R<this.nodes.length;R++)p.$5x(this.nodes[R])},o.prototype.$6x=function(){for(var A=0;A<this.dirtyNodes.length;A++)p.$5x(this.dirtyNodes[A]);this.dirtyNodes=[]},o.prototype.$7x=function(h){this.dirtyNodes.push(h)},o.prototype.neighbors=function(p){var U=[],f=p.x,t=p.y,N=this.grid;return N[f-1]&&N[f-1][t]&&U.push(N[f-1][t]),N[f+1]&&N[f+1][t]&&U.push(N[f+1][t]),N[f]&&N[f][t-1]&&U.push(N[f][t-1]),N[f]&&N[f][t+1]&&U.push(N[f][t+1]),this.diagonal&&(N[f-1]&&N[f-1][t-1]&&U.push(N[f-1][t-1]),N[f+1]&&N[f+1][t-1]&&U.push(N[f+1][t-1]),N[f-1]&&N[f-1][t+1]&&U.push(N[f-1][t+1]),N[f+1]&&N[f+1][t+1]&&U.push(N[f+1][t+1])),U},o.prototype.toString=function(){for(var j=[],Q=this.grid,d=0;d<Q.length;d++){for(var m=[],a=Q[d],p=0;p<a.length;p++)m.push(a[p].weight);j.push(m.join(" "))}return j.join("\n")},r.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},r.prototype.getCost=function(m,t){var j;if(j=m&&m.x!=this.x&&m.y!=this.y?1.41421*this.weight:this.weight,t){var f=m;if(!f)return j;var K=f.parent;if(!K)return j;if(Math.abs(K.x+this.x-2*f.x)>1e-5)return j+t;if(Math.abs(K.y+this.y-2*f.y)>1e-5)return j+t}return j},r.prototype.$9x=function(){return 0===this.weight},L.prototype={push:function(E){this.content.push(E),this.$11x(this.content.length-1)},pop:function(){var w=this.content[0],J=this.content.pop();return this.content.length>0&&(this.content[0]=J,this.$12x(0)),w},remove:function(n){var m=this.content.indexOf(n),K=this.content.pop();m!==this.content.length-1&&(this.content[m]=K,this.scoreFunction(K)<this.scoreFunction(n)?this.$11x(m):this.$12x(m))},size:function(){return this.content.length},$10x:function(B){this.$11x(this.content.indexOf(B))},$11x:function(e){for(var q=this.content[e];e>0;){var k=(e+1>>1)-1,p=this.content[k];if(!(this.scoreFunction(q)<this.scoreFunction(p)))break;this.content[k]=q,this.content[e]=p,e=k}},$12x:function(b){for(var o=this.content.length,O=this.content[b],P=this.scoreFunction(O);;){var R,m=b+1<<1,r=m-1,T=null;if(o>r){var V=this.content[r];R=this.scoreFunction(V),P>R&&(T=r)}if(o>m){var S=this.content[m],H=this.scoreFunction(S);(null===T?P:R)>H&&(T=m)}if(null===T)break;this.content[b]=this.content[T],this.content[T]=O,b=T}}},{astar:p,Graph:o}});var o=c.Astar.Finder=function(r,H){var X=this;X.gv=r,X.$13x(H),X.refreshMap()};o.prototype={},o.prototype.constructor=o,w.defineProperties(o.prototype,{_debugInfo:{get:function(){return this.gv._astarDebugInfo},set:function(N){this.gv._astarDebugInfo=N}}}),o.prototype.$13x=function(S){var d=this,W=d.$14x={};S=S||{};var k=S.gridSize||10;W.gridSizeX=S.gridSizeX||k,W.gridSizeY=S.gridSizeY||k,W.rect=S.rect,W.filter=S.filter,W.extendBlocks=S.extendBlocks||3,W.fastOverlap=S.fastOverlap===x?!0:S.fastOverlap,W.nodeRectExtend=S.nodeRectExtend||0,W.diagonal=S.diagonal===x?!0:S.diagonal,W.turnPunish=S.turnPunish===x?.1:S.turnPunish,W.simplify=S.simplify===x?!0:S.simplify,W.toGridCenter=S.toGridCenter===x?!1:S.toGridCenter,W.closest=S.closest===x?!0:S.closest},o.prototype.refreshMap=function(){var M,s=this,G=s.$14x,r=G.gridSizeX,S=G.gridSizeY,u=G.extendBlocks;G.rect?M=G.rect:(M=s.$15x(),c.Default.grow(M,r*u,S*u)),c.Default.grow(M,r,S);var F=Math.floor(M.x/r)*r,k=Math.floor(M.y/S)*S,D=Math.ceil(M.width/r),E=Math.ceil(M.height/S),U=D*r,q=E*S;s.$16x={x:F,y:k,w:U,h:q,gridX:r,gridY:S,xLen:D,yLen:E},s.$17x(),s.$21x()},o.prototype.$15x=function(){var I=this.gv;if(I instanceof c.graph.GraphView)return I.getContentRect();var q,R=c.Default.unionRect;return I.dm().each(function(z){I.isVisible(z)&&z.getRect&&(q=R(q,z.getRect()))}),q},o.prototype.$17x=function(){var r,O,Y,k,f=this,s=f.$16x,I=s.xLen,e=s.yLen;for(r=new Array(I),Y=0;I>Y;Y++)for(r[Y]=O=new Array(e),k=e;k--;)O[k]=1;var P=f.$14x.filter;for(f.gv.dm().each(function(B){P&&P(B)===!1||(!f._debugInfo||B!==f._debugInfo.grid&&B!=f._debugInfo.path)&&f.$1cw(r,B)}),Y=0;I>Y;Y++)r[Y][0]=1,r[Y][e-1]=1;for(k=0;e>k;k++)r[0][k]=1,r[I-1][k]=1;f.grid=r;var o=new AStar.Graph(r,{diagonal:f.$14x.diagonal});f.graph=o},o.prototype.$18x=function(j,N,L,Y,I,V,K,f){var g=this.$19x,r=g(L-j,I-K,Y-N,V-f);if(1e-6>=r&&r>=-1e-6)return!1;var m=g(I-j,I-K,V-N,V-f)/r;if(0>m||m>1)return!1;var h=g(L-j,I-j,Y-N,V-N)/r;return 0>h||h>1?!1:!0},o.prototype.$19x=function(s,L,k,H){return s*H-L*k},o.prototype.$1aw=function(v,f,P,q){for(var Y=[-(f[1]-v[1]),f[0]-v[0]],B=Y[0]*(P[0]-v[0])+Y[1]*(P[1]-v[1])>=0,o=0,Z=q.length;Z>o;o+=2)if(Y[0]*(q[o]-v[0])+Y[1]*(q[o+1]-v[1])>=0===B)return!1;return!0},o.prototype.$1bw=function(b,J){for(var r,X,A=this,I=0,h=b.length;h>I;I+=2)if(r=I===h-2?0:I+2,X=r===h-2?0:r+2,A.$1aw([b[I],b[I+1]],[b[r],b[r+1]],[b[X],b[X+1]],J))return!1;for(var I=0,h=J.length;h>I;I+=2)if(r=I===h-2?0:I+2,X=r===h-2?0:r+2,A.$1aw([J[I],J[I+1]],[J[r],J[r+1]],[J[X],J[X+1]],b))return!1;return!0},o.prototype.$1cw=function(W,v){if(v.getRect){var e=this,h=v.getRect();c.Default.grow(h,e.$14x.nodeRectExtend);var d,b,U,C,u,l,E,r,A,L,$,_=e.$1dw({x:h.x,y:h.y}),D=e.$1dw({x:h.x+h.width,y:h.y+h.height}),g=e.$14x.fastOverlap;if(!g){var t=v.getCorners();E=[],t.forEach(function(F){E.push(F.x,F.y)}),L=e.$14x.gridSizeX/2,$=e.$14x.gridSizeY/2}for(b=Math.max(0,_.x),U=Math.min(D.x,W.length-1),u=Math.max(0,_.y),l=Math.min(D.y,W.length?W[0].length-1:-1),d=b;U>=d;d++)for(C=u;l>=C;C++)if(g)W[d][C]=0;else{A=e.$1ew({x:d,y:C});var y=A.x-L,G=A.x+L,K=A.y-$,m=A.y+$;r=[y,K,y,m,G,m,G,K],e.$1bw(E,r)&&(W[d][C]=0)}}},o.prototype.$1dw=function(s,C){var j=this,F=j.$16x,r=(s.x-F.x)/F.gridX,t=(s.y-F.y)/F.gridY;return C!==!1&&(r=Math.round(r),t=Math.round(t)),{x:r,y:t}},o.prototype.$1ew=function(s){var H=this,X=H.$16x;return{x:s.x*X.gridX+X.x,y:s.y*X.gridY+X.y}},o.prototype.$1fw=function(v){var B=this,o=B.$16x,H=o.xLen,r=o.yLen;if(v.x>=0&&v.x<H&&v.y>=0&&v.y<r)return v;var z={x:v.x,y:v.y};return z.x<0?z.x=0:z.x>=H&&(z.x=H-1),z.y<0?z.y=0:z.y>=r&&(z.y=r-1),z},o.prototype.findPath=function(t,c){var V,P,S,o,u=this,Q=u.$1dw(t),J=u.$1dw(c);if(S=u.$1fw(Q),o=u.$1fw(J),S!==Q&&o!==J){var x=u.$16x,r=x.x-x.gridX/2,Z=x.y-x.gridY/2,U=r+x.gridX*x.xLen,H=Z+x.gridY*x.yLen;if(!(u.$18x(t.x,t.y,c.x,c.y,r,Z,U,Z)||u.$18x(t.x,t.y,c.x,c.y,U,Z,U,H)||u.$18x(t.x,t.y,c.x,c.y,U,H,r,H)||u.$18x(t.x,t.y,c.x,c.y,r,H,r,Z)))return[t,c]}S!==Q&&(V=!0,Q=S),o!==J&&(P=!0,J=o);var K=u.graph.grid[Q.x][Q.y],W=u.graph.grid[J.x][J.y],G=AStar.search(u.graph,K,W,{closest:u.$14x.closest,punish:u.$14x.turnPunish});if(!G||!G.length)return null;var q=[];q.push(t),V&&q.push(u.$1ew(G[0]));for(var $=1,d=G.length;d-1>$;$++)q.push(u.$1ew(G[$]));if(P)q.push(u.$1ew(G[d-1])),q.push(c);else{var E=G[d-1];J.x!==E.x||J.y!==E.y||u.$14x.toGridCenter?q.push(u.$1ew(E)):q.push(c)}return u.$14x.simplify&&(q=u.simplifyPath(q)),u.$20x=q,u.$21x(),q},o.prototype.debugOn=function(f){this.debugFlag=!0,this.debugSettings=f||{},this.$21x()},o.prototype.simplifyPath=function(Q){var Z=Q.length;if(2>=Z)return Q;var T,K,X=[Q[0],Q[1]],H=X[0],u=X[1],c=1e-5;for(T=2;Z>T;T++)K=Q[T],Math.abs((u.x-H.x)*(K.y-H.y)-(u.y-H.y)*(K.x-H.x))<c?u=X[X.length-1]=K:(H=u,u=K,X.push(K));return X},o.prototype.$21x=function(){var U=this;if(U.$22x(),this.debugFlag){var S=U.grid;if(S){var f,d=U.gv;if(U.debugSettings.$16x!==!1){f=[];for(var a,E,v,g,s,F=[],W=U.$14x.gridSizeX/2,D=U.$14x.gridSizeY/2,N=S.length,y=N?S[0].length:0,V=1;N-1>V;V++)for(var n=1;y-1>n;n++)S[V][n]||(a=U.$1ew({x:V,y:n}),E=a.x-W,v=a.x+W,g=a.y-D,s=a.y+D,f.push({x:E,y:g},{x:E,y:s},{x:v,y:s},{x:v,y:g}),F.push(1,2,2,2,5));var A=new c.Shape;A.s("shape.border.color","rgba(50, 50, 50, 0.2)"),A.s("shape.border.width",1),A.s("shape.background","rgba(200, 50, 100, 0.2)"),A.s("2d.editable",!1),A.s("2d.selectable",!1),A.setPoints(f),A.setSegments(F),U._debugInfo={grid:A},d.dm().add(A)}U.debugSettings.path!==!1&&(f=new c.Shape,U.$20x&&(f.setPoints(U.$20x),f.s("shape.border.color","red"),f.s("shape.border.width",1),f.s("2d.editable",!1),f.s("2d.selectable",!1),f.s("shape.background",null),U._debugInfo||(U._debugInfo={}),U._debugInfo.path=f,d.dm().add(f)))}}},o.prototype.debugOff=function(){this.debugFlag=!1,this.$22x()},o.prototype.$22x=function(){var L=this;if(L._debugInfo){var n=L._debugInfo.grid,V=L._debugInfo.path,B=L.gv;n&&B.dm().remove(n),V&&B.dm().remove(V),L._debugInfo=null}}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);